<h1><%= @main_account.title %></h1>

<p>
  <strong>Currency:</strong>
  <%= @main_account.currency %>
</p>

<p>
  <strong>Balance:</strong>
  <%= number_to_currency(@main_account.balance, unit: "") %>
</p>

<p>
  <strong>Available Percentage:</strong>
  <%= @main_account.available_percentage %>%
</p>

<% if @main_account.owner == current_user %>
  <%= link_to "Edit Main Account", edit_main_account_path(@main_account), class: "button" %> |
  <%= link_to "Delete Main Account", main_account_path(@main_account), method: :delete, data: { confirm: "Are you sure you want to delete this Main Account?" }, class: "button" %>
<% end %> |
<%= link_to "Back to Main Accounts", main_accounts_path, class: "button" %>

<hr>

<h2>SubAccounts</h2>
<% if @main_account.owner == current_user %>
  <%= link_to "New SubAccount", new_main_account_sub_account_path(@main_account), class: "button" %>
<% end %>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>Percentage</th>
      <th>Balance</th>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody>
    <% @main_account.sub_accounts.each do |sub_account| %>
      <tr>
        <td><%= link_to sub_account.title, main_account_sub_account_path(@main_account, sub_account) %></td>
        <td><%= sub_account.percentage %>%</td>
        <td><%= number_to_currency(sub_account.balance, unit: "") %></td>
        <td>
          <% if @main_account.owner == current_user %>
            <%= link_to "Edit", edit_main_account_sub_account_path(@main_account, sub_account) %> |
            <%= link_to "Delete", main_account_sub_account_path(@main_account, sub_account), method: :delete, data: { confirm: "Are you sure you want to delete this SubAccount?" } %>
          <% else %>
            <span>â€”</span>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>

<h2>Partners</h2>
<% if @main_account.owner == current_user %>
  <%= link_to "Manage Partners", main_account_shared_main_account_users_path(@main_account), class: "button" %>
<% end %>

<ul>
  <% @main_account.partners.each do |partner| %>
    <li>
      <%= partner.first_name %> <%= partner.last_name %> (<%= partner.email %>)
      <% if @main_account.owner == current_user %>
        <%= link_to "Remove", main_account_shared_main_account_user_path(@main_account, partner.shared_main_account_users.find_by(user_id: partner.id)), method: :delete, data: { confirm: "Are you sure you want to remove this partner?" }, class: "button delete-button" %>
      <% end %>
    </li>
  <% end %>
</ul>
